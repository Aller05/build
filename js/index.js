!function(t){t.module("app",["ui.router","ngTouch","infinite-scroll"]).controller("appController",["$scope","$location","$state",function(o,a,e){document.body.addEventListener("touchstart",function(){}),o.$location=a,o.title="往期内容",o.isNav=!1,o.loginIn=!1,o.click=function(t){o.title=t,o.isNav=!o.isNav,o.$broadcast("calltitle",{title:t})},o.$on("authortitle",function(t,a){o.title=a.title+"的主页"}),o.autoNav=function(){o.homeItem=document.getElementsByTagName("homelist").length>0?document.getElementsByTagName("homelist"):document.getElementsByClassName("author-list"),t.forEach(o.homeItem,function(t,a,e){t.addEventListener("click",function(){"tabbar"!=event.target.id&&o.isNav&&(o.isNav=!o.isNav,o.$apply(),event.stopPropagation())},!0)})},o.swipeRight=function(){"-1"!=a.url().indexOf("detail")?o.$broadcast("swipeBack"):(o.isNav=!o.isNav,o.autoNav())},o.swipeLeft=function(){o.isNav&&(o.isNav=!o.isNav)},o.nav=function(){o.isNav=!o.isNav,event.stopPropagation(),o.autoNav()},o.goPast=function(){o.title="往期内容"},o.toDetail=function(){o.$broadcast("preScroll",$("body").scrollTop())}}])}(angular),function(t){t.module("app").config(["$sceDelegateProvider",function(t){t.resourceUrlWhitelist(["self","http://139.199.107.194:8088/**","http://127.0.0.1/api/**"])}])}(angular),function(t){t.module("app").config(["$stateProvider","$urlRouterProvider",function(t,o){t.state("app",{url:"/app",views:{home:{templateUrl:"view/home_tpl.html",controller:"homeController"},past:{templateUrl:"view/past_tpl.html",controller:"pastController"},author:{templateUrl:"view/author_tpl.html",controller:"authorController"},content:{},my:{}}}).state("app.home",{url:"/home",controller:[function(){window.scrollTo(0,0)}],template:"<homelist></homelist>"}).state("app.past",{url:"/past",controller:[function(){window.scrollTo(0,0)}],template:"<homelist></homelist>"}).state("app.detail",{url:"/detail/:index",controller:["$scope","$stateParams",function(t,o){t.listItem=t.homelist[o.index]}],template:"<detail></detail>"}).state("app.author",{url:"/author",template:"<authorlist></authorlist>"}).state("app.authordetail",{url:"/authordetail/:index",controller:["$scope","$stateParams","myHttp",function(t,o,a){t.$emit("authortitle",{title:t.authrolist[o.index].name}),t.isLoading=!0;var e={url:"http://139.199.107.194:8088/moment/author.php",method:"jsonp",params:{id:t.authrolist[o.index].uid}};a.getHttp(e,function(o){t.homelist=o.posts,t.authormsg=o.author,t.isLoading=!1},function(t){console.log(t)})}],template:"<homelist></homelist>"}),o.otherwise("app/past")}])}(angular),function(t){t.module("app").controller("authorController",["$scope","myHttp",function(t,o){t.isLoading=!0,t.fangdaolian="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=";var a={url:"http://139.199.107.194:8088/moment/authorlist.php",method:"jsonp",params:null};o.getHttp(a,function(o){t.authrolist=o.authors,t.isLoading=!1},function(t){console.log(t)})}])}(angular),function(t){t.module("app").controller("homeController",["$scope","myHttp",function(t,o){t.pastnow=!1,t.isLoading=!0,t.isDetailCss=!0,t.fangdaolian="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=";var a={url:"http://139.199.107.194:8088/moment/homelist.php",method:"jsonp",params:null};o.getHttp(a,function(o){o.posts[0].topdate=o.date,t.homelist=o.posts,t.isLoading=!1},function(t){console.log(t)})}])}(angular),function(t){t.module("app").controller("pastController",["$scope","myHttp","$location","$timeout",function(t,o,a,e){t.pastnow=!0,t.isLoading=!0,t.fangdaolian="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=";var n=1,i=new Date;t.homelist=[],t.pastData=function(){t.isLoading=!0;var a=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+(i.getDate()-n),e={url:"http://139.199.107.194:8088/moment/past.php",method:"jsonp",params:{index:a}};o.getHttp(e,function(o){o.posts[0].topdate=o.date,o.posts[0].isPast=!0;for(var a=0;a<o.posts.length;a++)t.homelist.push(o.posts[a]);console.log(t.homelist),t.isLoading=!1},function(t){console.log(t)})},t.pastData(),t.scrollaa=function(){if(!t.isLoading){e.cancel(o);var o=e(function(){"/app/past"!=a.url()||t.isLoading||(n++,t.pastData())},40)}},t.flag=!0,$(window).scroll(function(){t.flag&&(t.flag=!1,e(function(){$(".isPastNow").each(function(){$(window).scrollTop()+175>=$(this).parent().offset().top?$(this).addClass("pastListDate"):$(this).removeClass("pastListDate")}),t.flag=!0},50))})}])}(angular),function(t){t.module("app").directive("authorlist",function(){return{restrict:"EA",templateUrl:"view/tpl/authorlist_tpl.html"}})}(angular),function(t){t.module("app").directive("detail",["$timeout","$window",function(t,o){return{restrict:"EA",template:'<div id="detail-content"  ng-class="{detailCss:isDetailCss}" ></div>',link:function(o,a,e){window.scrollTo(0,0),t(function(){o.isDetailCss=!1},1),a.html(o.listItem.content);for(var n=a.find("img"),i=1;i<n.length-1;i++){var l=o.fangdaolian+o.listItem.photos[i-1].small.url;n[i].setAttribute("src",l)}n[0].setAttribute("src",o.fangdaolian+o.listItem.author.avatar),n[n.length-1].setAttribute("src",o.fangdaolian+o.listItem.author.avatar)},replace:!0}}])}(angular),function(t){t.module("app").directive("homelist",function(){return{restrict:"EA",templateUrl:"view/tpl/homelist_tpl.html",link:function(t,o,a){}}})}(angular),function(t){t.module("app").directive("login",["$timeout",function(t){return{restrict:"EA",templateUrl:"view/tpl/login_tpl.html",link:function(o,a,e){o.blur=function(a){t(function(){"user"==a?o.userblur=!1:o.passwordblur=!1},100)}}}}])}(angular),function(t){t.module("app").directive("nav",["$location","$timeout","$state",function(t,o,a){return{restrict:"EA",templateUrl:"view/tpl/nav_tpl.html",link:function(a,e,n){a.$on("calltitle",function(t,o){a.preTitleName=o.title}),a.$on("preScroll",function(t,o){a.scrollToY=o}),e.find("a")[1].style.display="none",a.$location=t,a.$watch("$location.url()",function(t,o){"-1"!=t.indexOf("detail")?(e.find("a")[0].style.display="none",e.find("a")[1].style.display="block"):a.helpLoading="/app/past"!=t}),a.goBack=function(){e.find("a")[0].style.display="block",e.find("a")[1].style.display="none",o(function(){a.isDetailCss=!0},1),a.preTitleName&&(a.title=a.preTitleName),window.history.back(),$("body").animate({scrollTop:a.scrollToY},15)},a.$on("swipeBack",function(){a.goBack()})}}}])}(angular),function(t){t.module("app").directive("tabbar",function(){return{restrict:"EA",templateUrl:"view/tpl/tabbar_tpl.html"}})}(angular),function(t){t.module("app").service("myHttp",["$http",function(t){this.getHttp=function(o,a,e){if("post"==o.method){var n="";for(var i in o.params)n+=i+"="+o.params[i]+"&";n=n.slice(0,-1),t({url:o.url,method:o.method,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:n}).then(function(t){a(t.data)}).catch(function(t){e(t)})}else"get"!=o.method&&"jsonp"!=o.method||t({url:o.url,method:o.method,params:o.params}).then(function(t){a(t.data)}).catch(function(t){e(t)})}}])}(angular);